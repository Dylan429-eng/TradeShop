
<link rel="stylesheet" href="/css/livreur/dashboard.css">
<div class="dashboard-wrapper">
  <div class="dashboard-container">

    <!-- En-tÃªte -->
    <div class="dashboard-header">
      <h1>Bienvenue, <%= user.name %></h1>
      <p>Suivi de vos livraisons et commandes assignÃ©es</p>
    </div>

    <!-- Navigation par onglets -->
    <ul class="tab-nav">
      <li class="active" data-tab="stats">ðŸ“Š Statistiques</li>
      <li data-tab="encours">ðŸšš Commandes Ã  livrer</li>
      <li data-tab="livrees">âœ… Commandes livrÃ©es</li>
    </ul>

    <!-- Stats -->
    <div class="tab-content active" id="stats">
      <div class="grid grid-1-3">
        <div class="card">
          <div class="card-content">
            <div class="card-icon">âœ…</div>
            <div>
              <h2><%= commandesJourLivrees %></h2>
              <p>Commandes livrÃ©es aujourd'hui</p>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-content">
            <div class="card-icon">ðŸ•’</div>
            <div>
              <h2><%= commandesAssignes %></h2>
              <p>Commandes Ã  livrer</p>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-content">
            <div class="card-icon">ðŸ“¦</div>
            <div>
              <h2><%= totalCommandes %></h2>
              <p>Total commandes assignÃ©es</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Commandes en cours -->
    <div class="tab-content" id="encours">
      <div class="card">
        <h3>Commandes Ã  livrer</h3>

        <% if (commandesEnCours.length > 0) { %>
          <div class="table-wrapper">
            <table class="table">
              <thead>
                <tr>
                  <th>Client</th>
                  <th>Adresse</th>
                  <th>Produits</th>
                  <th>Statut</th>
                  <th>Date</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <% commandesEnCours.forEach(c => { %>
                  <tr>
                    <td><%= c.client.name %></td>
                    <td><%= c.client.lieu %></td>
                    <td>
                      <% c.produits.forEach(p => { %>
                        <span class="badge"><%= p.nom %></span>
                      <% }) %>
                    </td>
                    <td>
                      <span class="badge <%= c.statut === 'livrÃ©' ? 'bg-green' : 'bg-yellow' %>">
                        <%= c.statut.charAt(0).toUpperCase() + c.statut.slice(1) %>
                      </span>
                    </td>
                    <td><%= c.createdAt.toLocaleString() %></td>
                    <td>
                      <% if (c.statut !== 'livrÃ©') { %>
                        <form action="/livreur/commandes/<%= c.id %>/confirmer" method="POST">
                          <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                          <button type="submit" class="btn btn-success">Confirmer</button>
                        </form>
                      <% } else { %>
                        <span class="badge bg-green">DÃ©jÃ  livrÃ©e</span>
                      <% } %>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } else { %>
          <p>Aucune commande Ã  livrer</p>
        <% } %>
      </div>
    </div>

    <!-- Commandes livrÃ©es -->
    <div class="tab-content" id="livrees">
      <div class="card">
        <h3>Commandes livrÃ©es aujourd'hui</h3>

        <% if (commandesJour.length > 0) { %>
          <div class="table-wrapper">
            <table class="table">
              <thead>
                <tr>
                  <th>Client</th>
                  <th>Adresse</th>
                  <th>Produits</th>
                  <th>Date livraison</th>
                </tr>
              </thead>
              <tbody>
                <% commandesJour.forEach(c => { %>
                  <tr>
                    <td><%= c.client.name %></td>
                    <td><%= c.client.lieu %></td>
                    <td>
                      <% c.produits.forEach(p => { %>
                        <span class="badge"><%= p.nom %></span>
                      <% }) %>
                    </td>
                    <td><%= c.updatedAt.toLocaleString() %></td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } else { %>
          <p>Aucune commande livrÃ©e aujourd'hui</p>
        <% } %>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const tabs = document.querySelectorAll(".tab-nav li");
    const contents = document.querySelectorAll(".tab-content");

    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        tabs.forEach(t => t.classList.remove("active"));
        contents.forEach(c => c.classList.remove("active"));
        tab.classList.add("active");
        document.getElementById(tab.dataset.tab).classList.add("active");
      });
    });
  });
</script>
